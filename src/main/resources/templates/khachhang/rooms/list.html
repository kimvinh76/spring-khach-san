<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách phòng khách sạn</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        .room-card {
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        .filter-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .stats-card {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }
        .price-range {
            color: #28a745;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .availability-badge {
            font-size: 0.8rem;
        }
        .pagination-custom {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .sort-btn {
            border: 1px solid #dee2e6;
            background: white;
            transition: all 0.3s ease;
        }
        .sort-btn:hover, .sort-btn.active {
            background: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/rooms/home">
                <i class="bi bi-building"></i> Khách sạn Demo
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/rooms/home">Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/rooms">Phòng & Giá</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/services">Dịch vụ</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/cart">
                            <i class="bi bi-cart"></i> Giỏ hàng
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-3">
                    <i class="bi bi-house-door text-primary"></i>
                    Danh sách phòng khách sạn
                </h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center">
                        <li class="breadcrumb-item"><a href="/rooms/home">Trang chủ</a></li>
                        <li class="breadcrumb-item active">Danh sách phòng</li>
                    </ol>
                </nav>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="stats-card">
                    <h4 class="mb-0" th:text="${totalCount}">0</h4>
                    <small>Tổng phòng</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stats-card">
                    <h4 class="mb-0" th:text="${availableCount}">0</h4>
                    <small>Phòng trống</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stats-card">
                    <h4 class="mb-0" th:text="${totalPages}">0</h4>
                    <small>Tổng trang</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stats-card">
                    <h4 class="mb-0" th:text="${pageSize}">0</h4>
                    <small>Phòng/trang</small>
                </div>
            </div>
        </div>

        <!-- Advanced Filter Section -->
        <div class="filter-section">
            <h4 class="mb-4">
                <i class="bi bi-funnel"></i> Bộ lọc nâng cao
            </h4>
            <form method="get" th:action="@{/rooms}" id="filterForm">
                <div class="row g-3">
                    <!-- Search -->
                    <div class="col-md-6 col-lg-3">
                        <label class="form-label">Tìm kiếm</label>
                        <div class="input-group">
                            <span class="input-group-text bg-white">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" name="search" class="form-control" 
                                   th:value="${search}" placeholder="Tên phòng, loại phòng...">
                        </div>
                    </div>
                    
                    <!-- Room Type -->
                    <div class="col-md-6 col-lg-3">
                        <label class="form-label">Loại phòng</label>
                        <select name="roomTypeId" class="form-select">
                            <option value="">Tất cả loại phòng</option>
                            <option th:each="type : ${roomTypes}" 
                                    th:value="${type.id}" 
                                    th:text="${type.tenLoai}"
                                    th:selected="${roomTypeId == type.id}">
                            </option>
                        </select>
                    </div>
                    
                    <!-- Availability -->
                    <div class="col-md-6 col-lg-2">
                        <label class="form-label">Trạng thái</label>
                        <select name="available" class="form-select">
                            <option value="all" th:selected="${available == null}">Tất cả</option>
                            <option value="true" th:selected="${available == true}">Còn trống</option>
                            <option value="false" th:selected="${available == false}">Đã đặt</option>
                        </select>
                    </div>
                    
                    <!-- Price Range -->
                    <div class="col-md-6 col-lg-2">
                        <label class="form-label">Giá từ (VNĐ)</label>
                        <input type="number" name="minPrice" class="form-control" 
                               th:value="${minPrice}" th:placeholder="${priceMin}">
                    </div>
                    
                    <div class="col-md-6 col-lg-2">
                        <label class="form-label">Giá đến (VNĐ)</label>
                        <input type="number" name="maxPrice" class="form-control" 
                               th:value="${maxPrice}" th:placeholder="${priceMax}">
                    </div>
                </div>
                
                <!-- Sort Options -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <label class="form-label">Sắp xếp theo</label>
                        <div class="d-flex gap-2 flex-wrap">
                            <button type="button" class="btn btn-sm sort-btn" 
                                    th:classappend="${sortBy == 'name' ? 'active' : ''}"
                                    onclick="setSortAndSubmit('name', 'asc')">
                                <i class="bi bi-sort-alpha-down"></i> Tên A-Z
                            </button>
                            <button type="button" class="btn btn-sm sort-btn"
                                    th:classappend="${sortBy == 'price' and sortDir == 'asc' ? 'active' : ''}"
                                    onclick="setSortAndSubmit('price', 'asc')">
                                <i class="bi bi-sort-numeric-down"></i> Giá thấp
                            </button>
                            <button type="button" class="btn btn-sm sort-btn"
                                    th:classappend="${sortBy == 'price' and sortDir == 'desc' ? 'active' : ''}"
                                    onclick="setSortAndSubmit('price', 'desc')">
                                <i class="bi bi-sort-numeric-up"></i> Giá cao
                            </button>
                            <button type="button" class="btn btn-sm sort-btn"
                                    th:classappend="${sortBy == 'roomType' ? 'active' : ''}"
                                    onclick="setSortAndSubmit('roomType', 'asc')">
                                <i class="bi bi-house"></i> Loại phòng
                            </button>
                        </div>
                        <input type="hidden" name="sortBy" th:value="${sortBy}">
                        <input type="hidden" name="sortDir" th:value="${sortDir}">
                    </div>
                    
                    <!-- Page Size -->
                    <div class="col-md-6">
                        <label class="form-label">Hiển thị</label>
                        <div class="d-flex gap-2 align-items-center">
                            <select name="size" class="form-select" style="width: auto;">
                                <option value="6" th:selected="${pageSize == 6}">6 phòng</option>
                                <option value="12" th:selected="${pageSize == 12}">12 phòng</option>
                                <option value="24" th:selected="${pageSize == 24}">24 phòng</option>
                                <option value="48" th:selected="${pageSize == 48}">48 phòng</option>
                            </select>
                            <button type="submit" class="btn btn-light">
                                <i class="bi bi-search"></i> Lọc
                            </button>
                            <a href="/rooms" class="btn btn-outline-light">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </a>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Results Summary -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="text-muted">
                            Hiển thị <strong th:text="${(currentPage-1)*pageSize + 1}">1</strong> - 
                            <strong th:text="${currentPage*pageSize > totalRooms ? totalRooms : currentPage*pageSize}">12</strong> 
                            trong tổng số <strong th:text="${totalRooms}">0</strong> phòng
                        </span>
                        <span th:if="${search}" class="badge bg-primary ms-2">
                            Tìm kiếm: "<span th:text="${search}"></span>"
                        </span>
                    </div>
                    <div class="price-range" th:if="${priceMin != null and priceMax != null}">
                        <i class="bi bi-currency-dollar"></i>
                        Khoảng giá: <span th:text="${#numbers.formatDecimal(priceMin, 0, 'COMMA', 0, 'POINT')}"></span> - 
                        <span th:text="${#numbers.formatDecimal(priceMax, 0, 'COMMA', 0, 'POINT')}"></span> VNĐ
                    </div>
                </div>
            </div>
        </div>
        <!-- Room Grid -->
        <div class="row" id="roomGrid">
            <div class="col-12" th:if="${#lists.isEmpty(rooms)}">
                <div class="text-center py-5">
                    <i class="bi bi-search display-1 text-muted"></i>
                    <h4 class="mt-3 text-muted">Không tìm thấy phòng nào</h4>
                    <p class="text-muted">Hãy thử điều chỉnh bộ lọc để tìm phòng phù hợp</p>
                    <a href="/rooms" class="btn btn-primary">
                        <i class="bi bi-arrow-clockwise"></i> Xem tất cả phòng
                    </a>
                </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-4" th:each="room : ${rooms}">
                <div class="room-card">
                    <div class="room-image-container">
                        <img th:src="@{'/images/rooms/' + ${room.image}}"
                             th:alt="${room.name}"
                             src="/images/rooms/default.jpg"
                             alt="Room Image"
                             class="room-image">
                        <div class="room-overlay">
                            <a th:href="@{/rooms/detail/{id}(id=${room.id})}" class="btn btn-light">
                                <i class="bi bi-eye"></i> Xem chi tiết
                            </a>
                        </div>
                        <div class="room-badge" th:classappend="${room.available ? 'available' : 'unavailable'}">
                            <i class="bi bi-check-circle" th:if="${room.available}"></i>
                            <i class="bi bi-x-circle" th:unless="${room.available}"></i>
                            <span th:text="${room.available ? 'Còn trống' : 'Đã đặt'}"></span>
                        </div>
                    </div>

                    <div class="room-content">
                        <div class="room-header">
                            <h5 class="room-title" th:text="${room.name}">Room Name</h5>
                            <div class="room-type">
                                <i class="bi bi-house-door"></i>
                                <span th:text="${room.roomType.tenLoai}">Room Type</span>
                            </div>
                        </div>

                        <div class="room-description" th:if="${room.description}">
                            <p th:text="${#strings.abbreviate(room.description, 120)}">Room description...</p>
                        </div>

                        <div class="room-features">
                            <div class="feature-item" th:if="${room.capacity}">
                                <i class="bi bi-person"></i>
                                <span th:text="${room.capacity + ' khách'}">2 khách</span>
                            </div>
                        </div>

                        <div class="room-amenities" th:if="${room.roomType.amenities}">
                            <small class="text-muted" th:text="${#strings.abbreviate(room.roomType.amenities, 80)}">
                                Tiện nghi: Wi-Fi, TV, Điều hòa...
                            </small>
                        </div>
                    </div>

                    <div class="room-footer">
                        <div class="room-price">
                            <span class="price" th:text="${#numbers.formatDecimal(room.roomType.priceBase, 0, 'COMMA', 0, 'POINT')}">1,500,000</span>
                            <span class="currency">VNĐ/đêm</span>
                        </div>
                        <div class="room-actions">
                            <a th:href="@{/rooms/detail/{id}(id=${room.id})}" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-info-circle"></i> Chi tiết
                            </a>
                            <a th:href="@{/booking/new?roomId={id}(id=${room.id})}"
                               class="btn btn-primary btn-sm"
                               th:if="${room.available}">
                                <i class="bi bi-calendar-check"></i> Đặt phòng
                            </a>
                            <form th:action="@{'/rooms/add-to-cart/' + ${room.id}}" method="post" th:if="${room.available}" style="display:inline-block;width:auto;">
                                <button type="submit" class="btn btn-warning btn-sm">
                                    <i class="bi bi-cart-plus"></i> Lưu
                                </button>
                            </form>
                            <button class="btn btn-secondary btn-sm"
                                    th:unless="${room.available}" disabled>
                                <i class="bi bi-lock"></i> Hết phòng
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Professional Pagination -->
        <nav aria-label="Room pagination" th:if="${totalPages > 1}">
            <div class="pagination-container">
                <div class="pagination-info">
                    <span class="text-muted">
                        Trang <strong th:text="${currentPage}">1</strong> 
                        trong tổng số <strong th:text="${totalPages}">5</strong> trang
                    </span>
                </div>
                
                <ul class="pagination">
                    <!-- First Page -->
                    <li class="page-item" th:classappend="${currentPage == 1 ? 'disabled' : ''}">
                        <a class="page-link" th:href="@{/rooms(page=1, size=${pageSize}, search=${search}, roomTypeId=${roomTypeId}, minPrice=${minPrice}, maxPrice=${maxPrice}, available=${available}, sortBy=${sortBy}, sortDir=${sortDir})}"
                           th:if="${currentPage != 1}">
                            <i class="bi bi-chevron-double-left"></i>
                        </a>
                        <span class="page-link" th:if="${currentPage == 1}">
                            <i class="bi bi-chevron-double-left"></i>
                        </span>
                    </li>
                    
                    <!-- Previous Page -->
                    <li class="page-item" th:classappend="${currentPage == 1 ? 'disabled' : ''}">
                        <a class="page-link" th:href="@{/rooms(page=${currentPage-1}, size=${pageSize}, search=${search}, roomTypeId=${roomTypeId}, minPrice=${minPrice}, maxPrice=${maxPrice}, available=${available}, sortBy=${sortBy}, sortDir=${sortDir})}"
                           th:if="${currentPage > 1}">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                        <span class="page-link" th:if="${currentPage == 1}">
                            <i class="bi bi-chevron-left"></i>
                        </span>
                    </li>
                    
                    <!-- Page Numbers -->
                    <li class="page-item" th:each="i : ${#numbers.sequence(startPage, endPage)}"
                        th:classappend="${i == currentPage ? 'active' : ''}">
                        <a class="page-link" th:href="@{/rooms(page=${i}, size=${pageSize}, search=${search}, roomTypeId=${roomTypeId}, minPrice=${minPrice}, maxPrice=${maxPrice}, available=${available}, sortBy=${sortBy}, sortDir=${sortDir})}"
                           th:text="${i}"
                           th:if="${i != currentPage}">1</a>
                        <span class="page-link" th:if="${i == currentPage}" th:text="${i}">1</span>
                    </li>
                    
                    <!-- Next Page -->
                    <li class="page-item" th:classappend="${currentPage == totalPages ? 'disabled' : ''}">
                        <a class="page-link" th:href="@{/rooms(page=${currentPage+1}, size=${pageSize}, search=${search}, roomTypeId=${roomTypeId}, minPrice=${minPrice}, maxPrice=${maxPrice}, available=${available}, sortBy=${sortBy}, sortDir=${sortDir})}"
                           th:if="${currentPage < totalPages}">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                        <span class="page-link" th:if="${currentPage == totalPages}">
                            <i class="bi bi-chevron-right"></i>
                        </span>
                    </li>
                    
                    <!-- Last Page -->
                    <li class="page-item" th:classappend="${currentPage == totalPages ? 'disabled' : ''}">
                        <a class="page-link" th:href="@{/rooms(page=${totalPages}, size=${pageSize}, search=${search}, roomTypeId=${roomTypeId}, minPrice=${minPrice}, maxPrice=${maxPrice}, available=${available}, sortBy=${sortBy}, sortDir=${sortDir})}"
                           th:if="${currentPage != totalPages}">
                            <i class="bi bi-chevron-double-right"></i>
                        </a>
                        <span class="page-link" th:if="${currentPage == totalPages}">
                            <i class="bi bi-chevron-double-right"></i>
                        </span>
                    </li>
                </ul>
                
                <!-- Quick Jump -->
                <div class="page-jump">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text">Đến trang</span>
                        <input type="number" class="form-control" id="pageJump" 
                               min="1" th:max="${totalPages}" th:value="${currentPage}"
                               style="width: 80px;">
                        <button class="btn btn-outline-primary" onclick="jumpToPage()">
                            <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-5 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5><i class="bi bi-building"></i> Khách sạn Demo</h5>
                    <p>Mang đến trải nghiệm lưu trú tuyệt vời với dịch vụ chuyên nghiệp và tiện nghi hiện đại.</p>
                    <div class="social-links">
                        <a href="#" class="text-light me-3"><i class="bi bi-facebook"></i></a>
                        <a href="#" class="text-light me-3"><i class="bi bi-instagram"></i></a>
                        <a href="#" class="text-light me-3"><i class="bi bi-twitter"></i></a>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <h6>Liên kết nhanh</h6>
                    <ul class="list-unstyled">
                        <li><a href="/rooms/home" class="text-light">Trang chủ</a></li>
                        <li><a href="/rooms" class="text-light">Phòng & Giá</a></li>
                        <li><a href="/services" class="text-light">Dịch vụ</a></li>
                        <li><a href="/contact" class="text-light">Liên hệ</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-4">
                    <h6>Thông tin liên hệ</h6>
                    <p><i class="bi bi-geo-alt"></i> 123 Đường ABC, Quận 1, TP.HCM</p>
                    <p><i class="bi bi-phone"></i> +84 901 234 567</p>
                    <p><i class="bi bi-envelope"></i> info@khachsandemo.com</p>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center">
                <p class="mb-0">&copy; 2024 Khách sạn Demo. Tất cả quyền được bảo lưu.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sort functionality
        function setSortAndSubmit(sortBy, sortDir) {
            document.querySelector('input[name="sortBy"]').value = sortBy;
            document.querySelector('input[name="sortDir"]').value = sortDir;
            document.getElementById('filterForm').submit();
        }

        // Page jump functionality
        function jumpToPage() {
            const pageNum = document.getElementById('pageJump').value;
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('page', pageNum);
            window.location.href = '/rooms?' + urlParams.toString();
        }

        // Auto-submit on page size change
        document.querySelector('select[name="size"]').addEventListener('change', function() {
            document.getElementById('filterForm').submit();
        });

        // Smooth scroll to results
        document.getElementById('filterForm').addEventListener('submit', function() {
            setTimeout(function() {
                document.getElementById('roomGrid').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 100);
        });

        // Price range validation
        document.querySelector('input[name="minPrice"]').addEventListener('blur', function() {
            const minPrice = parseFloat(this.value);
            const maxPriceInput = document.querySelector('input[name="maxPrice"]');
            const maxPrice = parseFloat(maxPriceInput.value);
            
            if (minPrice && maxPrice && minPrice > maxPrice) {
                maxPriceInput.value = minPrice;
            }
        });

        // Loading animation for filter
        document.getElementById('filterForm').addEventListener('submit', function() {
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-arrow-clockwise spin"></i> Đang lọc...';
            submitBtn.disabled = true;
            
            setTimeout(function() {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 2000);
        });
    </script>

    <style>
        .spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</body>
</html>
