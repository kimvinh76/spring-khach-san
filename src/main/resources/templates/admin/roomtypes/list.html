<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head th:replace="~{admin/layout :: head}">
    <title>Danh sách loại phòng</title>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">
        <nav th:replace="~{admin/layout :: navbar}"></nav>
        <aside th:replace="~{admin/layout :: sidebar}"></aside>
        
        <!-- Content Wrapper -->
        <div class="content-wrapper">
            <!-- Content Header -->
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                        <div class="col-sm-6">
                            <h1>
                                <i class="fas fa-layer-group mr-2"></i>
                                Quản lý loại phòng
                            </h1>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb float-sm-right">
                                <li class="breadcrumb-item"><a href="/admin/home">Trang chủ</a></li>
                                <li class="breadcrumb-item active">Loại phòng</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-list mr-1"></i>
                                Danh sách loại phòng
                            </h3>
                            <div class="card-tools">
                                <a href="/admin/roomtypes/new" class="btn btn-primary btn-sm">
                                    <i class="fas fa-plus mr-1"></i>
                                    Thêm mới
                                </a>
                            </div>
                        </div>
                        
                        <div class="card-body">
    <!-- DEBUG: Hiển thị chi tiết từng loại phòng -->
    <ul style="background:#f8f9fa;color:#c7254e;padding:8px;">
      <li th:each="roomType : ${roomTypes}">
        [[${roomType.id}]] - [[${roomType.tenLoai}]] - [[${roomType.priceBase}]] - [[${roomType.amenities}]] - [[${roomType.description}]]
      </li>
    </ul>
                            <!-- Search Box đơn giản -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <input type="text" id="searchInput" class="form-control" 
                                               placeholder="Tìm kiếm loại phòng..." onkeyup="searchTable()">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 text-right">
                                    <span class="badge badge-info">
                                        Tổng: <span th:text="${#lists.size(roomTypes)}">0</span> loại phòng
                                    </span>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-bordered table-striped table-hover" id="roomTypeTable">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th style="width: 80px;">ID</th>
                                            <th>Tên loại phòng</th>
                                            <th>Mô tả</th>
                                            <th style="width: 150px;">Giá cơ bản</th>
                                            <th>Tiện nghi</th>
                                            <th style="width: 120px;">Hành động</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="roomType : ${roomTypes}">
                                            <td>
                                                <span class="badge badge-primary" th:text="${roomType.id}">1</span>
                                            </td>
                                            <td>
                                                <strong th:text="${roomType.tenLoai}">Tên loại</strong>
                                            </td>
                                            <td>
                                                <span th:text="${roomType.description ?: 'Không có mô tả'}" 
                                                      class="text-muted">Mô tả</span>
                                            </td>
                                            <td>
                                                <span class="text-success font-weight-bold">
                                                    <span th:text="${roomType.priceBase != null ? #numbers.formatDecimal(roomType.priceBase, 0, 'COMMA', 3, 'POINT') + ' VNĐ' : '0 VNĐ'}">0 VNĐ</span>
                                                </span>
                                            </td>
                                            <td>
                                                <span th:if="${roomType.amenities != null and !roomType.amenities.isEmpty()}"
                                                      th:text="${roomType.amenities}"
                                                      class="badge badge-info badge-sm">Tiện nghi</span>
                                                <span th:if="${roomType.amenities == null or roomType.amenities.isEmpty()}" 
                                                      class="text-muted font-italic">Chưa có</span>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a th:href="@{'/admin/roomtypes/edit/' + ${roomType.id}}" 
                                                       class="btn btn-warning" title="Chỉnh sửa">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <button type="button" class="btn btn-info" 
                                                            data-toggle="modal" data-target="#detailModal" 
                                                            th:attr="data-id=${roomType.id},
                                                                    data-tenloai=${roomType.tenLoai != null && !#strings.isEmpty(roomType.tenLoai) ? roomType.tenLoai : 'N/A'},
                                                                    data-description=${roomType.description != null && !#strings.isEmpty(roomType.description) ? roomType.description : 'Không có mô tả'},
                                                                    data-price=${roomType.priceBase != null ? #numbers.formatDecimal(roomType.priceBase, 0, 'COMMA', 3, 'POINT') + ' VNĐ' : '0 VNĐ'},
                                                                    data-amenities=${roomType.amenities != null && !#strings.isEmpty(roomType.amenities) ? roomType.amenities : 'Chưa có'}"
                                                            title="Xem chi tiết">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-danger" title="Xóa"
                                                            data-toggle="modal" data-target="#deleteRoomTypeModal"
                                                            th:attr="data-id=${roomType.id},data-tenloai=${roomType.tenLoai}">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- Nếu không có dữ liệu -->
                                        <tr th:if="${#lists.isEmpty(roomTypes)}">
                                            <td colspan="6" class="text-center text-muted">
                                                <i class="fas fa-info-circle mr-2"></i>
                                                Chưa có loại phòng nào
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <footer th:replace="~{admin/layout :: footer}"></footer>
    </div>

    <!-- Scripts -->
    <th:block th:replace="~{admin/layout :: scripts}"/>
    <script>
    // Hàm tìm kiếm đơn giản
    function searchTable() {
        var input = document.getElementById("searchInput");
        var filter = input.value.toUpperCase();
        var table = document.getElementById("roomTypeTable");
        var tr = table.getElementsByTagName("tr");
        for (var i = 1; i < tr.length; i++) {
            var found = false;
            var td = tr[i].getElementsByTagName("td");
            for (var j = 0; j < td.length; j++) {
                if (td[j]) {
                    var txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        found = true;
                        break;
                    }
                }
            }
            tr[i].style.display = found ? "" : "none";
        }
    }

    // Modal chi tiết loại phòng
    $(document).ready(function() {
        $('#detailModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            // DEBUG: Log toàn bộ data-* của button
            console.log('DATA ATTRIBUTES:', button.data());
            $('#modalRoomTypeId').text(button.data('id'));
            $('#modalRoomTypeName').text(button.data('tenloai'));
            $('#modalRoomTypeDescription').text(button.data('description') || 'Không có mô tả');
            $('#modalRoomTypePrice').text(button.data('price') ? button.data('price').toLocaleString() + ' VNĐ' : '0 VNĐ');
            $('#modalRoomTypeAmenities').text(button.data('amenities') || 'Chưa có');
        });

        // Modal xác nhận xóa loại phòng
        var deleteRoomTypeUrl = '';
        $('#deleteRoomTypeModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var id = button.data('id');
            var tenloai = button.data('tenloai');
            $('#deleteRoomTypeName').text(tenloai);
            deleteRoomTypeUrl = '/admin/roomtypes/delete/' + id;
        });
        $('#confirmDeleteRoomTypeBtn').click(function() {
            window.location.href = deleteRoomTypeUrl;
        });
    });
    </script>

<!-- Modal xem chi tiết loại phòng -->
<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="detailModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detailModalLabel">Chi tiết loại phòng</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <ul class="list-group">
          <li class="list-group-item"><strong>ID:</strong> <span id="modalRoomTypeId"></span></li>
          <li class="list-group-item"><strong>Tên loại:</strong> <span id="modalRoomTypeName"></span></li>
          <li class="list-group-item"><strong>Mô tả:</strong> <span id="modalRoomTypeDescription"></span></li>
          <li class="list-group-item"><strong>Giá cơ bản:</strong> <span id="modalRoomTypePrice"></span></li>
          <li class="list-group-item"><strong>Tiện nghi:</strong> <span id="modalRoomTypeAmenities"></span></li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal xác nhận xóa loại phòng -->
<div class="modal fade" id="deleteRoomTypeModal" tabindex="-1" role="dialog" aria-labelledby="deleteRoomTypeModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteRoomTypeModalLabel">Xác nhận xóa</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Bạn có chắc chắn muốn xóa loại phòng <strong id="deleteRoomTypeName"></strong> không?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteRoomTypeBtn">Xóa</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
